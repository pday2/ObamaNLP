President Obama vowed federal support for the beleaguered residents of this city on Wednesday and said government officials at all levels should have prevented Flint's water supply from being contaminated with lead.

In his first visit to the city since the water crisis began, Mr. Obama received updates from local officials and residents, made a show of drinking filtered tap water, and told a crowd of about 1,000 people at a high school that they deserved more from their leaders.

"I've come here to tell you that I've got your back, that we're paying attention," Mr. Obama told the crowd, which cheered loudly.

"I will not rest," he vowed, "and I'm going to make sure that the leaders at every level of government don't rest until every drop of water that flows to your home is safe to drink and safe to cook with and safe to bathe in, because that's part of the basic responsibilities of a government in the United States of America."

Mr. Obama, who coughed occasionally throughout the speech, paused at one point and looked offstage. "Can I get a glass of water?" he asked, drawing laughs and applause.

"I really did need a glass of water," Mr. Obama said as he sipped the water that an aide handed to him. "This is not a stunt."

Many here welcomed the president's message, but his visit, months after the magnitude of the water crisis became apparent, also prompted expressions of exasperation from residents who are still struggling to confront the health and safety repercussions of drinking lead-tainted water for months.

When he landed in Flint on Wednesday, the president was greeted with evident good will from people here, many of whom voted for him twice and consider themselves supporters.

But mixed with the affection were misgivings. Many Flint residents say that the federal Environmental Protection Agency shares the blame for failing to forcefully intervene early in the crisis, even after receiving complaints in 2014 that the water was foul and discolored.

Dozens of neighbors and demonstrators gathered across the street from the high school where Mr. Obama was scheduled to appear. Some chanted in unison, "Obama, Obama, can't you see, this Flint water is killing me." Others waved bottles filled with brown water and wore T-shirts emblazoned with the slogan #FlintLivesMatter. Volunteers carried clipboards, busily soliciting signatures as part of a statewide effort to recall Gov. Rick Snyder.

In the seventh month since officials acknowledged the crisis, with unfiltered water still unsafe to drink, many remain angry with Mr. Snyder for the state's failure to prevent the contamination. When Mr. Snyder tried to apologize to the crowd on Wednesday, he had to speak over repeated eruptions of boos and jeers.

"You didn't create this problem," he said. "Government failed you."

"You failed us," several people in the audience yelled.

But residents are also impatient that more federal aid has not made its way to Flint so that the lead pipes that contributed to the contamination can be replaced.

On Tuesday, Valerie Smith paused from taking orders at Spectacular Spudz at the Flint Farmers' Market to recall her thoughts when she heard about Mr. Obama's visit.

"I was like, 'Obama's coming?' " she said, cracking a smile. " 'That's great. Bring a check.' "

The Department of Health and Human Services announced a $10 million grant on Wednesday for health services in Michigan, including $1 million for a health center in Flint that is treating those affected by the water. White House officials said the federal government had already provided nine million liters of water and 55,000 water filters.

"It's a little too late," Jimmie Stephen, a truck driver, said as he walked down Saginaw Street in downtown Flint on Tuesday. "The E.P.A. had a job to do, and they ignored it. None of the politicians have helped us. I think the community is just going to have to band together to resolve our problems."

Mr. Obama had been under pressure for months to visit Flint. White House aides said he had decided to make the trip after receiving a letter from an 8-year-old girl, Amariyanna Copeny, who is known among many in the city as Little Miss Flint.

After receiving a briefing from federal officials who have been on the ground in Flint for months, Mr. Obama urged residents to use filters for their drinking water and to make sure that children received medical checkups. At the end of the briefing, he took a sip from a glass of Flint water after saying, "Filtered water is safe."

Karen Weaver, the mayor of Flint, told the high school audience that Mr. Obama deserved credit for a robust response to the crisis. "We asked for help, Mr. President, and you answered the call," she said.

But critics have said the federal government was conspicuously absent during the crucial months before the crisis was declared, when residents were drinking the lead-tainted water, and state and local officials were largely brushing off their concerns.

Emails from last summer, which were among thousands of pages of messages and documents released this year, show a lack of alarm about the crisis on the part of some E.P.A. officials. Susan Hedman, a regional administrator for the agency, resigned in January, and Gina McCarthy, the administrator of the E.P.A., withstood withering attacks by Republicans during a House Oversight Committee hearing about the agency's failure to step in. She had argued that states bore primary responsibility for water safety.

Officials at the E.P.A. pointed out Wednesday that a commission had concluded that state officials were primarily responsible and that investigations into the crisis had led to indictments of people at the state and local levels. Monica Lee, a spokeswoman for the agency, said the federal government had not been told the truth about the situation in Flint.

"We can't serve our oversight role when the state is lying to us about what they're doing," Ms. Lee said.

Mr. Obama also used his visit to Flint as an opportunity to pressure Republicans in Congress to support billions of dollars in improvements to infrastructure around the country. He tweaked them and some of the party's presidential candidates, who have suggested deep cuts to federal environmental programs.

The president chided Republicans for a "corrosive attitude" that does not support government investments in public infrastructure.

"It's a mind-set that says that environmental rules designed to keep your water clean or your air clean are optional or not that important," Mr. Obama said. "That attitude is as corrosive to our democracy as the stuff that results in lead in your water. It leads to systemic neglect. It leads to carelessness and callousness."
